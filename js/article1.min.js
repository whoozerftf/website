// Minified: see original for comments and formatting
