console.log("login.js?v=4" loaded");import{auth,db,GoogleAuthProvider,signInWithEmailAndPassword}from"./firebase-config.js?v=4"?v=3";import{signInWithPopup}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js?v=4"?v=3";import{createUserWithEmailAndPassword,sendEmailVerification,signOut,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js?v=4"?v=3";import{doc,setDoc}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js?v=4"?v=3";const loading=document.getElementById("loading");function showLoading(e){loading&&(loading.style.display=e?"flex":"none")}function showRegister(){document.getElementById("loginForm")?.classList.add("hidden"),document.getElementById("registerForm")?.classList.remove("hidden")}function showLogin(){document.getElementById("registerForm")?.classList.add("hidden"),document.getElementById("loginForm")?.classList.remove("hidden")}const registerForm=document.getElementById("registerSubmit");registerForm&&registerForm.addEventListener("submit",async e=>{e.preventDefault(),showLoading(!0);const t=document.getElementById("registerUsername").value.trim(),a=document.getElementById("registerEmail").value.trim(),n=document.getElementById("registerPhone").value.trim(),o=document.getElementById("registerPassword").value,r=document.getElementById("confirmPassword").value;if(o!==r)return alert("Password tidak cocok!"),void showLoading(!1);if(o.length<6)return alert("Password minimal 6 karakter!"),void showLoading(!1);try{const r=await createUserWithEmailAndPassword(auth,a,o),d=r.user;await setDoc(doc(db,"users",d.uid),{username:t,email:a,phone:n,createdAt:new Date}),await sendEmailVerification(d),alert("Registrasi berhasil! Silakan verifikasi email."),showLogin(),registerForm.reset()}catch(e){let t="Gagal register: "+e.message;"auth/email-already-in-use"===e.code?t="Email sudah terdaftar. Silakan gunakan email lain.":"auth/invalid-email"===e.code?t="Format email tidak valid.":"auth/operation-not-allowed"===e.code?t="Pendaftaran dengan email/password dinonaktifkan. Silakan coba login atau hubungi admin.":"auth/weak-password"===e.code&&(t="Password terlalu lemah. Gunakan kombinasi huruf, angka, dan simbol."),loading?(()=>{let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent=t+" (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}})():alert(t),showLoading(!1)}finally{showLoading(!1)}});const loginForm=document.getElementById("loginSubmit");loginForm&&loginForm.addEventListener("submit",async e=>{e.preventDefault(),showLoading(!0);const t=document.getElementById("loginEmail").value.trim(),a=document.getElementById("loginPassword").value;try{const e=await signInWithEmailAndPassword(auth,t,a),n=e.user;if(!n.emailVerified){if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent="Email belum diverifikasi. Silakan cek email Anda dan lakukan verifikasi terlebih dahulu. (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}}else showLoading(!1);return await signOut(auth),void 0}if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg login-success-msg",e.title="",loading.appendChild(e)),e.textContent="Login berhasil!",e.style.display="block",e.className="login-error-msg login-success-msg",e.removeAttribute("style"),setTimeout(()=>{e.style.display="none",showLoading(!1),window.location.href="index.html"},1200)}else showLoading(!1),window.location.href="index.html"}catch(e){let t="Gagal login: "+e.message;"auth/user-not-found"===e.code?t="Akun tidak ditemukan.":"auth/wrong-password"===e.code?t="Password salah. Silakan coba lagi.":"auth/invalid-email"===e.code?t="Format email tidak valid.":"auth/too-many-requests"===e.code?t="Akun diblokir sementara karena terlalu banyak percobaan login gagal. Silakan coba lagi nanti.":"auth/invalid-credential"===e.code&&(t="Email atau Password salah."),loading?(()=>{let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent=t+" (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}})():alert(t),showLoading(!1)}});const googleLoginBtn=document.getElementById("googleLoginBtn");googleLoginBtn&&googleLoginBtn.addEventListener("click",async()=>{const e=new GoogleAuthProvider;showLoading(!0);try{const t=await signInWithPopup(auth,e),a=t.user,n=t._tokenResponse?.isNewUser;if(n){if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent="Akun Google Anda belum terdaftar di Whoozer. Silakan daftar terlebih dahulu. (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}}else showLoading(!1);return await signOut(auth),void 0}if(!a.emailVerified){if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent="Email Google Anda belum diverifikasi. Silakan cek email Anda dan lakukan verifikasi terlebih dahulu. (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}}else showLoading(!1);return await signOut(auth),void 0}if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg login-success-msg",e.title="",loading.appendChild(e)),e.textContent="Login berhasil!",e.style.display="block",e.className="login-error-msg login-success-msg",e.removeAttribute("style"),setTimeout(()=>{e.style.display="none",showLoading(!1),window.location.href="index.html"},1200)}else showLoading(!1),window.location.href="index.html"}catch(e){let t="Login Google gagal: "+e.message;loading?(()=>{let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent=t+" (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}})():showLoading(!1)}});const googleRegisterBtn=document.getElementById("googleRegisterBtn");googleRegisterBtn&&googleRegisterBtn.addEventListener("click",async()=>{const e=new GoogleAuthProvider;showLoading(!0);try{const t=await signInWithPopup(auth,e),a=t.user,n=t._tokenResponse?.isNewUser;if(!n){if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent="Akun Google sudah terdaftar, silakan login. (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}}else showLoading(!1);return await signOut(auth),void 0}if(!a.emailVerified){if(loading){let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent="Email Google Anda belum diverifikasi. Silakan cek email Anda dan lakukan verifikasi terlebih dahulu. (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}}else showLoading(!1);return await signOut(auth),void 0}await setDoc(doc(db,"users",a.uid),{username:a.displayName||"",email:a.email,phone:a.phoneNumber||"",createdAt:new Date}),loading?(()=>{let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg login-success-msg",e.title="",loading.appendChild(e)),e.textContent="Registrasi Google berhasil!",e.style.display="block",e.className="login-error-msg login-success-msg",e.removeAttribute("style"),setTimeout(()=>{e.style.display="none",showLoading(!1),window.location.href="index.html"},1200)}):showLoading(!1),window.location.href="index.html"}catch(e){let t="Registrasi Google gagal: "+e.message;loading?(()=>{let e=loading.querySelector(".login-error-msg");e||(e=document.createElement("div"),e.className="login-error-msg",e.title="Klik untuk menutup",loading.appendChild(e)),e.textContent=t+" (Klik untuk menutup)",e.style.display="block",e.className="login-error-msg",e.removeAttribute("style"),e.onclick=function(){e.style.display="none",showLoading(!1)}})():showLoading(!1)}});onAuthStateChanged(auth,e=>{console.log("ðŸ”„ onAuthStateChanged triggered. User:",e),e&&(console.log("âœ… User is signed in:",e),window.location.href="index.html")});document.querySelectorAll('[data-action="showRegister"]').forEach(e=>e.addEventListener("click",t=>{t.preventDefault(),showRegister()})),document.querySelectorAll('[data-action="showLogin"]').forEach(e=>e.addEventListener("click",t=>{t.preventDefault(),showLogin()}));
